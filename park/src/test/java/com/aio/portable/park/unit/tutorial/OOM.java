package com.aio.portable.park.unit.tutorial;

import org.junit.Test;
import org.springframework.boot.test.context.TestComponent;
import org.springframework.cglib.proxy.Callback;
import org.springframework.cglib.proxy.Enhancer;
import org.springframework.cglib.proxy.MethodInterceptor;
import org.springframework.cglib.proxy.MethodProxy;

import java.lang.reflect.Method;
import java.util.ArrayList;
import java.util.List;

@TestComponent
public class OOM {
    // -XX:MaxMetaspaceSize=10M
    public static final void oomMetaspace1() {
        int i = 1;
        while (i == 1) {
            Enhancer enhancer = new Enhancer();
            enhancer.setSuperclass(Callback.class);
            enhancer.setUseCache(false);
            enhancer.setCallback(new MethodInterceptor() {
                public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {
                    return methodProxy.invokeSuper(o, objects);
                }
            });
            Callback callback = (Callback) enhancer.create();
        }
    }

    @Test
    // -XX:MaxMetaspaceSize=10M
    public static final void oomMetaspace2() {
        String text = "akh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888ttttttttttttttttttttttttttttttttttttttttttttttakh888888888888888888tttttttttttttttttttttttttttttttttttttttttttttt";
        int i = 1;
        while (i == 1) {
            text = (text + text + text + text + text + text + text + text + text + text + text + text + text + text + text + text + text + text + text).intern();
        }
    }

    @Test
    // -Xms500M -Xmx500M
    public static final void oomHeapSpace() {
        int i = 1;
        List<OOM> list = new ArrayList<>();
        while (i == 1) {
            OOM oom = new OOM();
            list.add(oom);
            try {
                Thread.sleep(10);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }

    static long stack = 0;

    @Test
    // -Xss1m
    public static final void stackoverflow() {
//        Unsafe.allocateMemory(1024*1024*1024*1024*1024);



        try {
            stack++;
            stackoverflow();
        } catch (Error e) {
            e.printStackTrace();
            System.out.println(stack);
        }
    }

    public static final void ygc() {
        int i = 1;
        while (i == 1) {
            OOM oom = new OOM();
        }
    }
}
